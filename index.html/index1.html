<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Initial title for the browser tab -->
    <title id="mainTitle">Happy Birthday, Pari! </title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Tone.js library for sound generation -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.8.52/Tone.js"></script>

    <!-- Configure Tailwind for custom font and theme colors -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                        // A slightly more stylized font for display text
                        display: ['Georgia', 'serif'],
                    },
                    colors: {
                        // These colors now map to CSS variables for dynamic theming
                        'theme-primary': 'var(--color-primary)',
                        'theme-accent': 'var(--color-accent)',
                        'theme-secondary': 'var(--color-secondary)',
                        'theme-text': 'var(--color-text)',
                        'theme-dark-text': 'var(--color-dark-text)',
                        // Using a static gray for the sidebar background
                        'sidebar-bg': '#1e293b',
                    }
                }
            }
        }
    </script>

    <style>
        /* Import Inter font */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');

        /* --- Global Theme Variables (Default to Giyu - Water Hashira) --- */
        :root {
            --color-primary: #0f172a;
            --color-accent: #2dd4bf;
            --color-secondary: #67e8f9;
            --color-text: #e2e8f0;
            --color-dark-text: #0f172a;
        }

        /* --- Theme-Specific Body Styling --- */
        body {
            background: radial-gradient(circle at center, #1e293b, var(--color-primary));
            color: var(--color-text);
            min-height: 100vh;
            display: flex;
            transition: background-color 0.5s, color 0.5s;
        }
        
        /* Desktop/Tablet view: Push content over for the fixed sidebar */
        @media (min-width: 768px) {
            body {
                padding-left: 6rem; /* Space for the fixed sidebar */
            }
        }
        
        /* --- Sidebar Styles --- */
        #sidebar {
            position: fixed;
            top: 0;
            left: 0;
            height: 100%;
            width: 6rem;
            z-index: 10;
        }
        
        .sidebar-item {
            width: 4rem;
            height: 4rem;
            transition: transform 0.2s, background-color 0.2s;
            cursor: pointer;
        }

        .sidebar-item:hover {
            transform: scale(1.05);
            background-color: var(--color-accent); 
        }

        /* --- Ripple Effect for Buttons --- */
        .ripple-button {
            position: relative;
            overflow: hidden;
            background-color: var(--color-accent);
            color: var(--color-dark-text);
        }

        .ripple-button:after {
            content: "";
            position: absolute;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            pointer-events: none;
            background-image: radial-gradient(circle, #fff 10%, transparent 10.01%);
            background-repeat: no-repeat;
            background-position: 50%;
            transform: scale(10, 10);
            opacity: 0;
            transition: transform .5s, opacity 1s;
        }

        .ripple-button:active:after {
            transform: scale(0, 0);
            opacity: .3;
            transition: 0s;
        }

        /* --- Hashira Icons (Simple Emoji/Text) --- */
        .hashira-icon {
            font-size: 2rem;
            line-height: 1;
            transition: color 0.3s;
        }

        /* Custom alert/modal styling */
        #customAlert {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 50;
        }

        /* Aspect ratio for the video player container */
        .video-container {
            position: relative;
            width: 100%;
            padding-bottom: 56.25%; /* 16:9 Aspect Ratio */
            height: 0;
            overflow: hidden;
            border-radius: 1rem;
            box-shadow: 0 10px 25px var(--color-accent);
        }

        .video-container iframe {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }
    </style>
</head>
<body id="pageBody" class="font-sans antialiased transition-colors duration-500">

    <!-- Theme Sidebar (Desktop/Tablet Only) -->
    <div id="sidebar" class="hidden md:flex flex-col items-center py-6 bg-sidebar-bg border-r border-theme-accent/30 shadow-2xl shadow-theme-accent/20">
        <h2 class="text-xl font-bold text-theme-accent mb-6 font-display">柱</h2>
        
        <!-- Giyu (Water) -->
        <div id="giyuTheme" class="sidebar-item rounded-full flex items-center justify-center mb-4 bg-theme-accent/30 hover:bg-theme-accent/70"
             onclick="setTheme('giyu')" title="Giyu (Water)">
            <span class="hashira-icon">🌊</span>
        </div>

        <!-- Shinobu (Insect) -->
        <div id="shinobuTheme" class="sidebar-item rounded-full flex items-center justify-center mb-4 bg-theme-accent/30 hover:bg-theme-accent/70"
             onclick="setTheme('shinobu')" title="Shinobu (Insect)">
            <span class="hashira-icon">🦋</span>
        </div>

        <!-- Rengoku (Flame) -->
        <div id="rengokuTheme" class="sidebar-item rounded-full flex items-center justify-center mb-4 bg-theme-accent/30 hover:bg-theme-accent/70"
             onclick="setTheme('rengoku')" title="Rengoku (Flame)">
            <span class="hashira-icon">🔥</span>
        </div>

        <!-- Tengen (Sound) -->
        <div id="tengenTheme" class="sidebar-item rounded-full flex items-center justify-center mb-4 bg-theme-accent/30 hover:bg-theme-accent/70"
             onclick="setTheme('tengen')" title="Tengen (Sound)">
            <span class="hashira-icon">🎵</span>
        </div>
    </div>

    <!-- Main View Container -->
    <div class="flex-grow p-4 md:p-10 flex flex-col items-center justify-center min-h-screen">
        
        <!-- 1. HASHIRA CARD VIEW (Initial State) -->
        <div id="cardView" class="max-w-lg w-full bg-theme-primary/60 backdrop-blur-sm p-8 rounded-2xl shadow-2xl border-2 border-theme-accent/50 text-center transition-opacity duration-500">

            <!-- Mobile Theme Selector -->
            <div class="md:hidden mb-6">
                <label for="themeSelect" class="block text-theme-secondary font-bold mb-2">Select Hashira Theme:</label>
                <select id="themeSelect" onchange="setTheme(this.value)"
                    class="w-full p-3 rounded-lg bg-theme-primary border border-theme-accent/50 text-theme-text focus:ring-theme-accent focus:border-theme-accent">
                    <option value="giyu">🌊 Giyu (Water Hashira)</option>
                    <option value="shinobu">🦋 Shinobu (Insect Hashira)</option>
                    <option value="rengoku">🔥 Rengoku (Flame Hashira)</option>
                    <option value="tengen">🎵 Tengen (Sound Hashira)</option>
                </select>
            </div>

            <!-- Card Title -->
            <h1 id="themeTitle" class="text-3xl sm:text-4xl font-display font-extrabold text-theme-secondary mb-4 drop-shadow-lg">
                Water Breathing: Eleventh Form
            </h1>

            <!-- Introduction Text -->
            <div class="mb-6">
                <p class="text-lg text-theme-text/80 leading-relaxed">
                    Hello, Pari! This is a special, themed birthday message. To unlock the final video wish, you must prove your strength and find the one true form (the secret key)!
                </p>
            </div>
            
            <!-- Hashira Quote -->
            <div class="p-4 rounded-xl bg-theme-secondary/10 border border-theme-accent/30 min-h-[5rem] flex items-center justify-center">
                <p id="hashiraQuote" class="text-xl italic font-medium text-theme-secondary">
                    "Do not ever forget the hard work and effort you put into your life. Live with pride."
                </p>
            </div>
            
            <!-- Secret Key Input Field -->
            <div id="keyInputContainer" class="mt-6 mb-4 flex flex-col items-center">
                <input type="password" id="secretKeyInput" placeholder="Enter secret key..."
                    class="w-full max-w-xs p-3 rounded-lg bg-theme-primary border border-theme-accent/50 text-theme-text focus:ring-theme-accent focus:border-theme-accent mb-3 text-center" 
                    onkeydown="if(event.key === 'Enter') unlockMessage();" />
            </div>

            <!-- Action Area -->
            <div id="actionArea">
                <!-- Initial Unlock Button -->
                <button id="unlockButton" onclick="unlockMessage()"
                    class="ripple-button w-full sm:w-auto px-8 py-3 text-lg font-bold rounded-full transform hover:scale-105 transition duration-300 focus:outline-none focus:ring-4 focus:ring-theme-accent/70 shadow-lg shadow-theme-accent/30">
                    Unlock, your reward!
                </button>
            </div>
            
            <!-- Success Banner (Hidden until successful unlock) -->
            <div id="successBanner" class="hidden mt-6 p-4 rounded-xl bg-theme-accent/20 text-theme-accent border border-theme-accent/50 animate-pulse">
                <p class="text-xl font-semibold">
                    SUCCESS! Proceeding to the Final Video Wish...
                </p>
            </div>

            <!-- Signature -->
            <footer class="mt-8 pt-4 border-t border-theme-accent/30">
                <p class="text-sm text-theme-text/50">
                    — From your loving sibling (Amrendra)
                </p>
            </footer>

        </div>

        <!-- 2. VIDEO PLAYER VIEW (Hidden Initial State) -->
        <div id="videoPlayerView" class="hidden w-full max-w-2xl text-center transition-opacity duration-500">
            <h2 class="text-4xl font-display font-extrabold text-theme-accent mb-6">
                Congratulations, Hashira!
            </h2>
            <div class="mb-4 p-4 rounded-xl bg-theme-primary/60 border-2 border-theme-accent/50">
                <p class="text-xl text-theme-text/90">
                    You have mastered the technique. Here is your ultimate reward!
                </p>
            </div>

            <!-- Embedded Video Player -->
            <div class="video-container border-4 border-theme-accent">
                <!--
                    Replace this YouTube URL with your custom video.
                    Current placeholder is a Demon Slayer opening song embed link.
                -->
                <iframe id="videoFrame" width="100%" height="100%"
                    src="https://www.youtube.com/embed/mpW9k59Hj8U?autoplay=0&mute=0&rel=0&controls=1"
                    frameborder="0" 
                    allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
                    allowfullscreen>
                </iframe>
            </div>

            <button onclick="goToCardView()"
                class="mt-8 bg-theme-secondary text-theme-dark-text px-6 py-2 rounded-full font-semibold hover:bg-theme-secondary/80 transition duration-200">
                ← Return to Hashira Themes
            </button>
        </div>

    </div>
    
    <!-- Custom Modal/Alert Area -->
    <div id="customAlert" class="hidden max-w-sm w-full bg-red-800 text-white p-4 rounded-lg shadow-2xl border-2 border-red-500 fixed top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 z-50">
        <h3 id="alertTitle" class="font-bold text-lg mb-1"></h3>
        <p id="alertMessage" class="text-sm"></p>
        <button onclick="hideAlert()" class="mt-3 w-full p-2 bg-red-600 rounded-lg hover:bg-red-700 font-semibold transition">Close</button>
    </div>


    <!-- JavaScript Logic -->
    <script>
        // --- Configuration ---
        const UNLOCK_KEY = "pari";
        // NOTE: Add ?autoplay=1 to the VIDEO_URL to make it start automatically on transition
        const VIDEO_URL = "Pari.mp4"
        const CARD_URL = "https://www.youtube.com/embed/mpW9k59Hj8U?autoplay=0&mute=0&rel=0&controls=1"; // Non-autoplay version for reset

        
        // --- Tone.js Audio Setup ---
        let themeClickSynth;
        let successMelody;
        let isAudioContextReady = false;

        /** Initializes Tone.js instruments on the first user interaction. */
        async function initAudio() {
            if (isAudioContextReady) return;

            try {
                await Tone.start();
                isAudioContextReady = true;

                // 1. Synth for Button/Theme Clicks (Short pluck sound)
                themeClickSynth = new Tone.PluckSynth().toDestination();
                
                // 2. Synth for Success/Unlock Melody
                const successSynth = new Tone.Synth({
                    oscillator: { type: "sine" },
                    envelope: { attack: 0.01, decay: 0.2, sustain: 0.1, release: 0.5 }
                }).toDestination();

                // Success Melody sequence (C5-E5-G5-C6)
                const notes = ["C5", "E5", "G5", "C6"];
                
                successMelody = new Tone.Sequence((time, note) => {
                    successSynth.triggerAttackRelease(note, "8n", time);
                }, notes, "8n");
                
                successMelody.loop = false;
                
            } catch (e) {
                console.error("Could not initialize audio context:", e);
            }
        }

        // Global click handler to ensure audio context is started
        document.body.addEventListener('click', initAudio, { once: true });


        /** Plays a click sound (bright for success, low for error). */
        function playClickSound(isSuccess = true) {
            if (!isAudioContextReady || !themeClickSynth) return;
            
            if (isSuccess) {
                themeClickSynth.triggerAttackRelease("G4", "8n");
            } else {
                themeClickSynth.triggerAttackRelease("C3", "16n");
            }
        }

        /** Plays the success melody. */
        function playSuccessSound() {
            if (!isAudioContextReady || !successMelody) return;
            Tone.Transport.stop(); 
            Tone.Transport.start();
            successMelody.start(Tone.now());
        }

        // --- Hashira Theme Data ---
        const HASHIRA_THEMES = {
            giyu: {
                name: "Water Hashira - Giyu Tomioka",
                colors: { primary: '#0f172a', accent: '#2dd4bf', secondary: '#67e8f9', text: '#e2e8f0', darkText: '#0f172a' },
                title: "Water Breathing: Eleventh Form",
                quote: "\"Do not ever forget the hard work and effort you put into your life. Live with pride.\"",
                actionText: "Unlock Water Breathing, Eleventh Form!",
                tabTitle: "Water Breathing",
            },
            shinobu: {
                name: "Insect Hashira - Shinobu Kocho",
                colors: { primary: '#312e81', accent: '#a78bfa', secondary: '#fbcfe8', text: '#f8fafc', darkText: '#312e81' },
                title: "Insect Breathing: Dance of the Dragonfly",
                quote: "\"The bonds that we share can sometimes be more powerful than any technique.\"",
                actionText: "Discover the Dance of the Dragonfly!",
                tabTitle: "Insect Breathing",
            },
            rengoku: {
                name: "Flame Hashira - Kyojuro Rengoku",
                colors: { primary: '#7f1d1d', accent: '#f59e0b', secondary: '#fcd34d', text: '#fef3c7', darkText: '#7f1d1d' },
                title: "Flame Breathing: Ninth Form",
                quote: "\"Set your heart ablaze. Go beyond your limits.\"",
                actionText: "Ignite Flame Breathing, Ninth Form!",
                tabTitle: "Flame Breathing",
            },
            tengen: {
                name: "Sound Hashira - Tengen Uzui",
                colors: { primary: '#1c1917', accent: '#f97316', secondary: '#d6d3c7', text: '#f5f5f4', darkText: '#1c1917' },
                title: "Sound Breathing: Fifth Form",
                quote: "\"I am the god of festivities, the god of splendor!\"",
                actionText: "Prepare for the Fifth Form!",
                tabTitle: "Sound Breathing",
            }
        };

        /** Switches the entire page to the specified Hashira theme and plays a click sound. */
        function setTheme(hashiraKey) {
            playClickSound(true); 

            const theme = HASHIRA_THEMES[hashiraKey];
            if (!theme) return;

            const root = document.documentElement;

            // 1. Update CSS Variables
            root.style.setProperty('--color-primary', theme.colors.primary);
            root.style.setProperty('--color-accent', theme.colors.accent);
            root.style.setProperty('--color-secondary', theme.colors.secondary);
            root.style.setProperty('--color-text', theme.colors.text);
            root.style.setProperty('--color-dark-text', theme.colors.darkText);

            // 2. Update Dynamic Text Content
            document.getElementById('themeTitle').textContent = theme.title;
            document.getElementById('hashiraQuote').textContent = theme.quote;
            document.getElementById('unlockButton').textContent = theme.actionText;
            document.getElementById('mainTitle').textContent = `Happy Birthday | ${theme.tabTitle}`;

            // 3. Update the mobile selector 
            const mobileSelect = document.getElementById('themeSelect');
            if (mobileSelect) {
                mobileSelect.value = hashiraKey;
            }

            // 4. Save the selected theme
            localStorage.setItem('currentHashiraTheme', hashiraKey);
        }

        /** Custom "alert" implementation using a simple modal/message box. */
        function alertUser(title, message) {
            document.getElementById('alertTitle').textContent = title;
            document.getElementById('alertMessage').textContent = message;
            document.getElementById('customAlert').classList.remove('hidden');
        }

        /** Hides the custom alert box. */
        function hideAlert() {
            document.getElementById('customAlert').classList.add('hidden');
        }

        /** Handles the authentication logic and immediate redirection. */
        function unlockMessage() {
            const userInput = document.getElementById('secretKeyInput').value.toLowerCase().trim();
            
            if (userInput === UNLOCK_KEY) {
                playSuccessSound(); 
                
                // 1. Hide input and unlock button
                document.getElementById('unlockButton').classList.add('hidden'); 
                document.getElementById('keyInputContainer').classList.add('hidden'); 
                
                // 2. Show success message briefly
                document.getElementById('successBanner').classList.remove('hidden');

                // 3. Immediately transition to the video page after 1 second
                setTimeout(goToVideoPage, 1000);
                
            } else if (userInput.length > 0) {
                playClickSound(false); 
                alertUser("Incorrect Key!", "You do not possess the required strength to unlock this form yet. Try another Breathing Style!");
            }
        }

        /** Transitions from the Card View to the Video Player View. */
        function goToVideoPage() {
            document.getElementById('cardView').classList.add('hidden');
            document.getElementById('videoPlayerView').classList.remove('hidden');
            
            // Set the video source to include autoplay when showing the player
            const videoFrame = document.getElementById('videoFrame');
            videoFrame.src = "Pari.mp4";
        }

        /** Transitions from the Video Player View back to the Card View. */
        function goToCardView() {
            document.getElementById('videoPlayerView').classList.add('hidden');
            document.getElementById('cardView').classList.remove('hidden');

            // Stop the video by changing the source back to the non-autoplay version
            const videoFrame = document.getElementById('videoFrame');
            videoFrame.src = CARD_URL;

            // Since the user is authenticated, keep the card unlocked if needed,
            // but for a clean reset, we'll restore the input area.
            document.getElementById('unlockButton').classList.remove('hidden'); 
            document.getElementById('keyInputContainer').classList.remove('hidden'); 
            document.getElementById('successBanner').classList.add('hidden');
            document.getElementById('secretKeyInput').value = ''; 
        }

        /** Initialize the theme on page load. */
        window.onload = function() {
            const savedTheme = localStorage.getItem('currentHashiraTheme') || 'giyu';
            setTheme(savedTheme);
            hideAlert();
        };
    </script>
</body>
</html>